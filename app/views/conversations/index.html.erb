<div class="chat-container">
  <!-- Sidebar - List of conversations -->
  <div class="chat-sidebar">
    <div class="sidebar-header">
      <h4 class="mb-0">Chats</h4>
      <div class="header-icons">
        <button class="btn btn-link" data-bs-toggle="modal" data-bs-target="#newChatModal">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Search box -->
    <div class="search-box">
      <input type="text" class="form-control" placeholder="Search messenger..." id="searchInput">
    </div>
    
    <!-- Conversations list -->
    <div class="conversations-list">
      <% if @conversations.any? %>
        <% @conversations.each do |conversation| %>
          <% opposed_user = conversation.opposed_user(current_user) %>
          <% last_message = conversation.last_message %>
          <%= link_to conversation_messages_path(conversation), class: "conversation-item" do %>
            <div class="conversation-avatar">
              <div class="avatar-circle">
                <%= opposed_user.username.first.upcase %>
              </div>
            </div>
            <div class="conversation-info">
              <div class="conversation-name"><%= opposed_user.username %></div>
              <% if last_message %>
                <div class="conversation-preview"><%= truncate(last_message.body, length: 40) %></div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      <% else %>
        <div class="text-center text-muted p-4">
          <p>No conversations yet.</p>
          <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#newChatModal">
            Start a conversation
          </button>
        </div>
      <% end %>
    </div>
  </div>
  
  <!-- Welcome message (shown when no conversation selected) -->
  <div class="chat-welcome">
    <div class="text-center">
      <svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" fill="currentColor" class="bi bi-chat-dots mb-4 text-primary" viewBox="0 0 16 16">
        <path d="M5 8a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm4 0a1 1 0 1 1-2 0 1 1 0 0 1 2 0zm3 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2z"/>
        <path d="m2.165 15.803.02-.004c1.83-.363 2.948-.842 3.468-1.105A9.06 9.06 0 0 0 8 15c4.418 0 8-3.134 8-7s-3.582-7-8-7-8 3.134-8 7c0 1.76.743 3.37 1.97 4.6a10.437 10.437 0 0 1-.524 2.318l-.003.011a10.722 10.722 0 0 1-.244.637c-.079.186.074.394.273.362a21.673 21.673 0 0 0 .693-.125zm.8-3.108a1 1 0 0 0-.287-.801C1.618 10.83 1 9.468 1 8c0-3.192 3.004-6 7-6s7 2.808 7 6c0 3.193-3.004 6-7 6a8.06 8.06 0 0 1-2.088-.272 1 1 0 0 0-.711.074c-.387.196-1.24.57-2.634.893a10.97 10.97 0 0 0 .398-2z"/>
      </svg>
      <h3>Welcome to Message Me</h3>
      <p class="text-muted">Select a conversation to start messaging</p>
    </div>
  </div>
</div>

<!-- New Chat Modal -->
<div class="modal fade" id="newChatModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Start New Conversation</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="list-group">
          <% @users.each do |user| %>
            <%= link_to user.username, conversations_path(recipient_id: user.id), method: :post, class: "list-group-item list-group-item-action" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
